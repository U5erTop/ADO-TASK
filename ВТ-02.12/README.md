# Практические задания по ADO.NET

## Задание 1: Отслеживание изменений состояния строк в DataTable через RowState

**Описание:** Создайте приложение, которое заполняет DataTable данными об учащихся (ID, ФИО, Email, Класс, СредняяОценка) из List<T> или вручную добавляет несколько строк. После этого выполните следующие операции:

1. Добавьте 3 новых учащихся в DataTable и проверьте их состояние (должно быть Added);
2. Отредактируйте 2 существующих учащихся (измените их Email и среднюю оценку) и проверьте состояние (должно быть Modified);
3. Удалите 1 учащегося из DataTable и проверьте его состояние (должно быть Deleted);
4. Создайте метод, который выводит в консоль подробный отчёт о всех строках с указанием их RowState и изменённых полей;
5. Используйте DataTable.GetChanges() для получения только изменённых строк и выведите их в отдельный отчёт.

**Требования:** Все операции должны быть выполнены БЕЗ подключения к базе данных. Убедитесь, что состояния отображаются правильно на каждом этапе. Добавьте вывод информации в консоль или TextBox для наглядности.

---

## Задание 2: Работа с DataRowVersion при просмотре текущих и исходных значений

**Описание:** Расширьте приложение из Задания 1 или создайте новое, где вы:

1. Заполните DataTable информацией о товарах (ID, Название, Цена, Количество на складе, СтатусДоступности);
2. Измените несколько товаров (цену, количество на складе);
3. Используя DataRowVersion.Current и DataRowVersion.Original, создайте метод для вывода:
   - Исходного значения цены и текущего значения цены для каждого товара;
   - Разницу между новой и старой ценой;
   - Процент изменения цены;
4. Создайте специальный отчёт, который показывает только товары с изменённой ценой;
5. Добавьте возможность вывода всех версий для конкретной строки (используя Proposed, если применимо).

**Требования:** Убедитесь, что Original версия доступна только для Modified строк. Обработайте исключения при попытке доступа к несуществующим версиям. Выведите результаты в понятном формате (таблица, структурированный текст).

---

## Задание 3: Фильтрация и поиск данных в DataSet с использованием DataView

**Описание:** Создайте приложение для работы с DataSet, содержащим несколько таблиц:

1. Таблица "Сотрудники" (ID, ФИО, Отдел, Зарплата, ДатаНайма);
2. Таблица "Проекты" (ID, Название, Отдел, БюджетПроекта, ДатаНачала);

Реализуйте следующие функции:

1. Поиск сотрудников по фамилии (частичный поиск);
2. Фильтрацию сотрудников по отделу с использованием DataView;
3. Фильтрацию сотрудников с зарплатой выше определённого значения;
4. Сортировку результатов по дате найма (по возрастанию и убыванию);
5. Комбинированный поиск (например, найти сотрудников IT-отдела с зарплатой более 50,000 с сортировкой по ФИО);
6. Получение статистики по фильтрованным данным (средняя зарплата, количество сотрудников и т.д.).

**Требования:** Используйте методы DataTable.Select(), DataView с RowFilter и Sort. Выведите результаты в DataGridView или в консоль. Добавьте обработку ошибок для некорректных фильтров.

---

## Задание 4: Создание и настройка TableAdapter с использованием мастера конструктора

**Описание:** Создайте Windows Forms приложение с использованием TableAdapter через мастер конструктора:

1. Создайте (или используйте готовую) базу данных SQL Server с таблицей "Студенты" (StudentID INT PRIMARY KEY IDENTITY, ФИ NVARCHAR(100), Email NVARCHAR(100), Специальность NVARCHAR(100), ДатаПоступления DATE);
2. Создайте новый Dataset в Visual Studio;
3. Используя мастер конструктора, создайте TableAdapter для таблицы "Студенты" с подключением к БД;
4. Автоматически создайте несколько Fill-методов (например, FillBySpecialty, FillByEmail);
5. Отобразите данные в DataGridView через BindingSource;
6. Реализуйте добавление, редактирование и удаление записей через TableAdapter;
7. Добавьте кнопки для выполнения различных запросов (все студенты, студенты определённой специальности и т.д.).

**Требования:** TableAdapter должен быть создан через мастер конструктора, а не вручную. Используйте автоматически сгенерированные методы. Обеспечьте синхронизацию данных между DataGridView и базой данных.

---

## Задание 5: Получение данных через различные методы TableAdapter

**Описание:** Работая с созданным в Задании 4 TableAdapter, реализуйте получение данных несколькими способами:

1. Используйте TableAdapter.Fill() для заполнения всего DataTable;
2. Используйте TableAdapter.GetData() для получения данных в виде List<T> или DataTable;
3. Создайте пользовательский метод в TableAdapter для выборки студентов по диапазону дат поступления;
4. Создайте метод для получения одного конкретного студента по ID (используя GetDataBy или пользовательский метод);
5. Реализуйте постраничное получение данных (например, 10 записей за раз) для большого набора данных;
6. Добавьте методы для получения агрегированной информации (кол-во студентов, количество по специальностям).

**Требования:** Продемонстрируйте разницу между Fill() и GetData(). Используйте Where-условия в запросах. Покажите производительность при работе с большими объёмами данных. Добавьте обработку исключений для некорректных параметров.

---

## Задание 6: Использование TableAdapter для получения информации о структуре базы данных

**Описание:** Создайте приложение, которое использует TableAdapter для анализа структуры таблицы в БД:

1. Используйте TableAdapter для получения информации о таблице "Студенты" (из предыдущих заданий);
2. Получите DataTable.Columns и выведите информацию о каждой колонке:
   - Имя колонки;
   - Тип данных;
   - Может ли быть NULL;
   - Является ли первичным ключом;
   - Максимальную длину (если применимо);
3. Используйте GetSchemaTable() для получения полной информации о схеме;
4. Выведите все индексы таблицы (если есть);
5. Получите информацию о связях с другими таблицами (если они существуют);
6. Создайте метод для сравнения локальной структуры DataTable со структурой в БД.

**Требования:** Используйте встроенные методы ADO.NET для анализа схемы. Выведите результаты в структурированном формате (таблица, дерево, XML). Добавьте функцию экспорта информации о схеме.

---

## Задание 7: Сопоставление имён таблиц через DataTableMapping

**Описание:** Создайте приложение, которое демонстрирует использование DataTableMapping:

1. Создайте DataAdapter вручную (не через мастер), используя SqlDataAdapter;
2. Выполните SELECT-запросы, которые возвращают данные с разными именами:
   - Один запрос возвращает таблицу с именем "DStud" из БД под названием "Студенты";
   - Другой запрос возвращает "DProj" из таблицы "Проекты";
3. Используя DataTableMapping, сопоставьте эти исходные имена с более удобными локальными именами:
   - "DStud" → "Students" в DataSet;
   - "DProj" → "Projects" в DataSet;
4. Заполните DataSet используя созданные маппинги;
5. Убедитесь, что таблицы в DataSet имеют правильные локальные имена;
6. Создайте метод для вывода информации о всех маппингах в приложении.

**Требования:** Используйте только DataTableMapping, без использования мастера конструктора. Продемонстрируйте, почему это важно для работы с БД, имеющими нелогичные имена таблиц. Обработайте случаи, когда маппинг не найден.

---

## Задание 8: Сопоставление колонок через DataColumnMapping

**Описание:** Расширьте приложение из Задания 7, добавив работу с DataColumnMapping:

1. Используйте DataAdapter с SELECT-запросами, которые возвращают колонки с неудобными или нелогичными именами:
   - Запрос возвращает колонки: "s_id", "s_fio", "s_email", "s_spec" (вместо более понятных имён);
   - Другой запрос возвращает: "p_id", "p_name", "p_budget" (вместо Project_ID, ProjectName и т.д.);
2. Создайте DataColumnMapping для сопоставления этих имён с читаемыми:
   - "s_id" → "StudentID";
   - "s_fio" → "FullName";
   - "s_email" → "Email";
   - "s_spec" → "Specialization";
   - "p_id" → "ProjectID";
   - "p_name" → "ProjectName";
   - "p_budget" → "Budget";
3. Используя TableMapping.ColumnMappings, добавьте все необходимые маппинги;
4. Заполните DataSet и убедитесь, что таблицы содержат колонки с правильными именами;
5. Создайте отчёт, который показывает исходные имена БД и локальные имена;
6. Добавьте функциональность для добавления новых маппингов динамически.

**Требования:** Используйте только DataColumnMapping. Покажите разницу между данными до и после маппинга. Выведите результаты в DataGridView с правильными заголовками. Обработайте ошибки при попытке маппирования несуществующих колонок.

---

## Задание 9: Комплексная работа с RowState, версиями данных, фильтрацией и маппингами

**Описание:** Создайте комплексное приложение, которое объединяет все изученные концепции:

1. Используйте DataAdapter с DataTableMapping и DataColumnMapping для получения данных о сотрудниках и их проектах из БД;
2. Заполните DataSet с использованием маппингов (сопоставление имён таблиц и колонок);
3. Отобразите данные в DataGridView;
4. Реализуйте следующие функции:
   - Добавление новых сотрудников → проверка RowState (Added);
   - Редактирование сотрудников → проверка RowState (Modified) и сравнение Current vs Original версий;
   - Удаление сотрудников → проверка RowState (Deleted);
   - Поиск и фильтрацию по отделу, зарплате, дате найма используя DataView;
   - Отокупку и сохранение изменений обратно в БД;
   - Отмену изменений для конкретных строк (RejectChanges на конкретных DataRow);
5. Создайте детальный отчёт обо всех изменениях перед сохранением в БД:
   - Покажите какие строки будут добавлены, изменены, удалены;
   - Для измененных строк покажите старые и новые значения;
6. Добавьте валидацию данных перед отправкой изменений в БД.

**Требования:** Все компоненты должны работать вместе. Используйте правильные маппинги для всех таблиц и колонок. Обработайте все возможные исключения. Выведите информацию о состояниях в удобном формате (может быть дополнительная форма или панель).

---

## Задание 10: Оптимизация работы с большими объёмами данных через TableAdapter и DataSet

**Описание:** Создайте приложение для работы с большим объёмом данных (100,000+ записей):

1. Подготовьте БД с таблицей "Логи" (LogID, EventType, Timestamp, UserID, Description, Duration) с миллионом+ записей;
2. Создайте TableAdapter для получения данных;
3. Реализуйте следующие оптимизированные функции:
   - Постраничное получение данных (например, 1000 записей за раз) вместо загрузки всех данных сразу;
   - Фильтрацию по диапазону дат и типу события на уровне БД (используя WHERE в запросах);
   - Агрегацию данных (количество событий по типам, среднее время выполнения) с использованием SQL-запросов;
   - Асинхронное получение данных для предотвращения зависания UI;
   - Кэширование уже загруженных данных для ускорения повторных запросов;
4. Создайте Dashboard с виджетами:
   - Таблица последних событий (с пагинацией);
   - Статистика событий по типам;
   - График событий по времени;
   - Фильтры по дате и типу события;
5. Измерьте производительность различных подходов (загрузка всех данных vs постраничная загрузка vs кэширование);
6. Создайте отчёт о результатах измерений производительности.

**Требования:** Используйте TableAdapter для всех запросов к БД. Реализуйте асинхронность (async/await). Добавьте прогресс-бар для длительных операций. Используйте DataView для локальной фильтрации кэшированных данных. Обработайте ошибки подключения и таймауты. Выведите метрики производительности (время загрузки, объём памяти, время выполнения запросов).

---

## Дополнительные рекомендации

- **Для всех заданий:** Используйте обработку исключений (try-catch блоки) для перехвата ошибок БД, подключения, маппинга и других операций.
- **Валидация данных:** Перед добавлением или обновлением данных выполняйте валидацию (проверка на null, пустые строки, корректность типов и диапазонов).
- **Логирование:** Добавляйте логирование операций для отладки и аудита.
- **Документирование:** Каждый метод должен иметь комментарии, объясняющие его назначение и параметры.
- **Тестирование:** Создавайте unit-тесты для критических методов, особенно для работы с состояниями и маппингами.
